<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard - Viagens</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 flex min-h-screen font-sans">

  <!-- Sidebar -->
  <aside id="sidebar" class="w-64 bg-white shadow-md flex flex-col justify-between fixed inset-y-0 left-0 transform -translate-x-full md:translate-x-0 transition-transform duration-300 z-50">
    <div>
      <div class="p-6 flex items-center space-x-2">
        <span class="text-blue-600 text-2xl">‚úàÔ∏è</span>
        <div>
          <h1 class="font-bold text-lg text-gray-800">TravelTogether</h1>
          <p class="text-sm text-gray-500">Planeje. Compartilhe. Viaje.</p>
        </div>
      </div>
      <nav class="mt-6">
        <button onclick="showSection('dashboard')" id="btn-dashboard"
          class="w-full text-left flex items-center p-3 bg-blue-50 text-blue-600 rounded-md mx-3 mb-2">
          <span class="mr-3">üè†</span> Dashboard
        </button>
        <button onclick="showSection('salas')" id="btn-salas"
          class="w-full text-left flex items-center p-3 hover:bg-gray-100 text-gray-700 rounded-md mx-3">
          <span class="mr-3">üë•</span> Minhas Salas
        </button>
      </nav>
      <div class="mt-8 px-6">
        <h2 class="text-gray-500 text-sm mb-3 font-semibold">RESUMO R√ÅPIDO</h2>
        <ul class="space-y-2">
          <li class="flex justify-between text-gray-700">
            <span>Salas Ativas</span><span id="active-rooms-count" class="bg-blue-100 text-blue-600 px-2 rounded-full">0</span>
          </li>
          <li class="flex justify-between text-gray-700">
            <span>Tarefas Pendentes</span><span class="bg-yellow-100 text-yellow-600 px-2 rounded-full">7</span>
          </li>
          <li class="flex justify-between text-gray-700">
            <span>Enquetes Abertas</span><span class="bg-green-100 text-green-600 px-2 rounded-full">2</span>
          </li>
        </ul>
      </div>
    </div>
    <div class="p-6 border-t text-gray-700">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <div class="bg-green-500 text-white rounded-full w-8 h-8 flex items-center justify-center">
            <span id="userInitial">U</span>
          </div>
          <div>
            <p class="font-medium" id="sidebarUserName">Usu√°rio</p>
            <p class="text-sm text-gray-500">Planeje suas pr√≥x...</p>
          </div>
        </div>
        <button onclick="logout()" class="ml-3 text-red-500 hover:text-red-700 text-sm">Sair</button>
      </div>
    </div>
  </aside>

  <!-- Overlay para mobile -->
  <div id="overlay" class="fixed inset-0 bg-black bg-opacity-50 hidden z-40 md:hidden" onclick="toggleSidebar()"></div>

  <!-- Main Content -->
  <main class="flex-1 p-4 md:p-8 md:ml-64">

    <!-- Bot√£o para abrir menu em mobile -->
    <button onclick="toggleSidebar()" class="md:hidden mb-4 bg-blue-500 text-white px-4 py-2 rounded-md">
      ‚ò∞ Menu
    </button>

    <!-- Container da Viagem -->
<div id="trip-container" class="bg-white p-6 rounded-2xl shadow mb-6">
  <div class="flex flex-wrap justify-between items-center gap-4">
    <div>
      <h2 class="text-xl font-bold text-gray-800" id="trip-name">{{ sala.name }}</h2>
      <p class="text-gray-500 flex flex-wrap items-center gap-4 mt-1">
        <span class="flex items-center gap-1">üìç 
          <span id="trip-location">{{ sala.destination }}</span>
        </span>
        <span class="flex items-center gap-1">üìÖ 
          <span id="trip-dates">
            {{ sala.start_date.strftime('%d %b %Y') }} at√© {{ sala.end_date.strftime('%d %b %Y') }}
          </span>
        </span>
        <span class="flex items-center gap-1">üë• 
          <span id="trip-participants">{{ participantes|length }} participante{{ 's' if participantes|length > 1 else '' }}</span>
        </span>
      </p>
    </div>
    <button class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-md">
      Configura√ß√µes
    </button>
  </div>
</div>

   <!-- Dashboard original e abas -->
<div class="bg-white rounded-2xl shadow p-6">
  <div class="flex flex-wrap gap-4 border-b pb-2 mb-6">
    <button class="tab-btn text-blue-600 font-semibold border-b-2 border-blue-600 pb-2" data-tab="roteiro">Roteiro</button>
    <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="enquetes">Enquetes</button>
    <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="gastos">Gastos</button>
    <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="tarefas">Tarefas</button>
    <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="membros">Membros</button>
  </div>

  <!-- ABA ROTEIRO -->
  <div id="roteiro" class="tab-content">
    <div id="roteiro-container" class="bg-gray-50 border rounded-2xl p-6 text-center" data-room-id="{{ sala.id }}">
      <h2 class="text-xl font-semibold mb-3">Roteiro da Viagem</h2>

    <!-- Formul√°rio de adicionar/editar mais harmonioso -->
<div id="form-roteiro" class="hidden mt-4 bg-white p-6 rounded-lg shadow">
  <input type="hidden" id="roteiro-id" value="">

  <!-- Linha com data e hor√°rios -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
    <div class="flex flex-col">
      <label for="dia-input" class="text-gray-600 text-sm mb-1">Data</label>
      <input type="date" id="dia-input" class="border p-2 rounded w-full">
    </div>

    <div class="flex flex-col">
      <label for="hora-inicio-input" class="text-gray-600 text-sm mb-1">Hor√°rio in√≠cio</label>
      <input type="time" id="hora-inicio-input" class="border p-2 rounded w-full">
    </div>

    <div class="flex flex-col">
      <label for="hora-fim-input" class="text-gray-600 text-sm mb-1">Hor√°rio fim</label>
      <input type="time" id="hora-fim-input" class="border p-2 rounded w-full">
    </div>
  </div>

  <!-- Descri√ß√£o ocupa toda a largura -->
  <div class="flex flex-col mb-4">
    <label for="descricao-input" class="text-gray-600 text-sm mb-1">Descri√ß√£o da atividade</label>
    <textarea id="descricao-input" class="border p-2 rounded w-full" rows="3" placeholder="Descri√ß√£o da atividade"></textarea>
  </div>

  <!-- Bot√µes -->
  <div class="flex justify-end gap-2">
    <button id="salvar-dia" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Salvar</button>
    <button id="cancelar-dia" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">Cancelar</button>
  </div>
</div>


      <!-- Lista de dias do roteiro -->
      <div id="dias-container" class="space-y-4 text-left mt-4">
        {% for r in roteiros %}
          <div class="bg-white border-l-4 border-blue-500 rounded-xl p-4 shadow hover:shadow-md transition flex justify-between items-start">
            <div>
              <div class="flex justify-between items-center mb-1">
                <p class="text-gray-700 font-semibold">üìÖ {{ r.dia.strftime('%d/%m/%Y') }}</p>
                {% if r.horario_inicio %}
                  <p class="text-sm text-gray-500">‚è∞ {{ r.horario_inicio }} - {{ r.horario_fim or '--:--' }}</p>
                {% endif %}
              </div>
              <p class="text-gray-600">{{ r.descricao }}</p>
            </div>
            <div class="flex flex-col gap-2 ml-4">
              
              <button class="delete-dia bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm" data-id="{{ r.id }}">
                Excluir
              </button>
            </div>
          </div>
        {% endfor %}
      </div>

      <!-- Bot√£o de adicionar dia -->
      <button id="adicionar-dia" class="mt-6 bg-emerald-500 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-emerald-600 transition">
        + Adicionar Dia
      </button>
    </div>
  </div>


      <!-- Enquetes -->
      <div id="enquetes" class="tab-content hidden">
        <div class="bg-gray-50 border rounded-2xl p-6 text-center" id="enquetes-container">
          <h2 class="text-xl font-semibold mb-3">Enquetes da Viagem</h2>
          <p id="mensagem-enquete-vazia" class="text-gray-500 mb-6">Nenhuma enquete criada ainda.</p>
          <div id="lista-enquetes" class="space-y-6 text-left"></div>
          <button id="adicionar-enquete" class="mt-6 bg-emerald-500 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-emerald-600 transition">
            + Criar Enquete
          </button>
        </div>
      </div>

      <!-- Gastos -->
      <div id="gastos" class="tab-content hidden">
        <div class="bg-gray-50 border rounded-2xl p-6 text-center" id="gastos-container">
          <h2 class="text-xl font-semibold mb-3">Controle de Gastos</h2>
          <p id="mensagem-gastos-vazia" class="text-gray-500 mb-6">Nenhum gasto registrado ainda.</p>
          <div id="lista-gastos" class="space-y-4 text-left"></div>
          <div id="total-gastos" class="hidden mt-6 text-lg font-semibold text-gray-700">
            Total: R$ <span id="valor-total">0,00</span>
          </div>
          <button id="adicionar-gasto" class="mt-6 bg-emerald-500 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-emerald-600 transition">
            + Adicionar Gasto
          </button>
        </div>
      </div>

      <!-- Tarefas -->
      <div id="tarefas" class="tab-content hidden">
        <div class="bg-gray-50 border rounded-2xl p-6 text-center" id="tarefas-container">
          <h2 class="text-xl font-semibold mb-3">Tarefas da Viagem</h2>
          <p id="mensagem-tarefas-vazia" class="text-gray-500 mb-6">Nenhuma tarefa adicionada ainda.</p>
          <div id="lista-tarefas" class="space-y-4 text-left"></div>
          <button id="adicionar-tarefa" class="mt-6 bg-emerald-500 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-emerald-600 transition">
            + Adicionar Tarefa
          </button>
        </div>
      </div>

      <!-- Membros -->
      <div id="membros" class="tab-content hidden">
        <div class="bg-gray-50 border rounded-2xl p-6 text-center" id="membros-container">
          <h2 class="text-xl font-semibold mb-3">Membros da Sala</h2>
          <p id="mensagem-membros-vazia" class="text-gray-500 mb-6">Nenhum membro adicionado ainda.</p>
          <div id="lista-membros" class="space-y-4 text-left"></div>
          <button id="adicionar-membro" class="mt-6 bg-emerald-500 text-white font-semibold px-6 py-3 rounded-lg shadow hover:bg-emerald-600 transition">
            + Adicionar Membro
          </button>
        </div>
      </div>
    </div>
  <script>
    // Interatividade das abas
    const tabs = document.querySelectorAll(".tab-btn");
    const contents = document.querySelectorAll(".tab-content");

    tabs.forEach(tab => {
      tab.addEventListener("click", () => {
        const target = tab.getAttribute("data-tab");
        tabs.forEach(btn => btn.classList.remove("text-blue-600", "font-semibold", "border-b-2", "border-blue-600"));
        tab.classList.add("text-blue-600", "font-semibold", "border-b-2", "border-blue-600");
        contents.forEach(content => content.classList.add("hidden"));
        document.getElementById(target).classList.remove("hidden");
      });
    });

    // -------------------------
    // Roteiro da viagem
    const btnAdicionarDia = document.getElementById("adicionar-dia");
    const diasContainer = document.getElementById("dias-container");
    const mensagemVazia = document.getElementById("mensagem-vazia");
    let contadorDias = 0;

    btnAdicionarDia.addEventListener("click", () => {
      mensagemVazia.classList.add("hidden");
      contadorDias++;

      const diaDiv = document.createElement("div");
      diaDiv.className = "bg-white p-4 border rounded-xl shadow-sm";
      diaDiv.innerHTML = `
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-lg font-semibold">Dia ${contadorDias}</h3>
          <button class="text-red-500 hover:text-red-700 text-sm font-medium remover-dia">Remover dia</button>
        </div>
        <div class="atividades space-y-3"></div>
        <button class="mt-3 bg-blue-500 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-600 adicionar-atividade">
          + Adicionar Atividade
        </button>
      `;
      diasContainer.appendChild(diaDiv);

      // Remover dia
      diaDiv.querySelector(".remover-dia").addEventListener("click", () => {
        diaDiv.remove();
        if (diasContainer.children.length === 0) {
          mensagemVazia.classList.remove("hidden");
          contadorDias = 0;
        }
      });

      // Adicionar atividade
      diaDiv.querySelector(".adicionar-atividade").addEventListener("click", () => {
        const atividadesContainer = diaDiv.querySelector(".atividades");
        const atividadeDiv = document.createElement("div");
        atividadeDiv.className = "flex flex-col md:flex-row md:items-center justify-between gap-2 bg-gray-50 p-2 rounded-lg border";
        atividadeDiv.innerHTML = `
          <div class="flex-1 flex flex-wrap gap-2 items-center">
            <input type="time" class="border rounded p-1 text-sm" />
            <input type="text" placeholder="Descri√ß√£o da atividade" class="border rounded p-1 text-sm flex-1" />
          </div>
          <button class="text-red-500 hover:text-red-700 text-xs remover-atividade">Remover</button>
        `;
        atividadesContainer.appendChild(atividadeDiv);

        // Remover atividade
        atividadeDiv.querySelector(".remover-atividade").addEventListener("click", () => {
          atividadeDiv.remove();
        });
      });
    });

    // -------------------------
    // Enquetes
    const btnAdicionarEnquete = document.getElementById("adicionar-enquete");
    const listaEnquetes = document.getElementById("lista-enquetes");
    const mensagemVaziaEnquete = document.getElementById("mensagem-enquete-vazia");
    let contadorEnquetes = 0;

    btnAdicionarEnquete.addEventListener("click", () => {
      mensagemVaziaEnquete.classList.add("hidden");
      contadorEnquetes++;

      const enqueteDiv = document.createElement("div");
      enqueteDiv.className = "bg-white p-4 border rounded-xl shadow-sm";
      enqueteDiv.innerHTML = `
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-lg font-semibold">Enquete ${contadorEnquetes}</h3>
          <button class="text-red-500 hover:text-red-700 text-sm font-medium remover-enquete">Remover enquete</button>
        </div>
        <div class="mb-3">
          <input type="text" placeholder="Pergunta da enquete (ex: Onde vamos jantar?)"
            class="w-full border rounded p-2 text-sm" />
        </div>
        <div class="opcoes space-y-2 mb-3">
          <div class="flex items-center">
            <input type="text" placeholder="Op√ß√£o 1" class="border rounded p-2 text-sm flex-1" />
            <button class="text-red-500 hover:text-red-700 text-xs ml-2 remover-opcao">Remover</button>
          </div>
          <div class="flex items-center">
            <input type="text" placeholder="Op√ß√£o 2" class="border rounded p-2 text-sm flex-1" />
            <button class="text-red-500 hover:text-red-700 text-xs ml-2 remover-opcao">Remover</button>
          </div>
        </div>
        <button class="bg-blue-500 text-white text-sm px-4 py-2 rounded-lg hover:bg-blue-600 adicionar-opcao">
          + Adicionar Op√ß√£o
        </button>
      `;
      listaEnquetes.appendChild(enqueteDiv);

      // Remover enquete
      enqueteDiv.querySelector(".remover-enquete").addEventListener("click", () => {
        enqueteDiv.remove();
        if (listaEnquetes.children.length === 0) {
          mensagemVaziaEnquete.classList.remove("hidden");
          contadorEnquetes = 0;
        }
      });

      // Adicionar op√ß√£o
      const adicionarOpcaoBtn = enqueteDiv.querySelector(".adicionar-opcao");
      const opcoesContainer = enqueteDiv.querySelector(".opcoes");
      adicionarOpcaoBtn.addEventListener("click", () => {
        const novaOpcao = document.createElement("div");
        novaOpcao.className = "flex items-center gap-2";
        novaOpcao.innerHTML = `
          <input type="text" placeholder="Nova op√ß√£o" class="border rounded p-2 text-sm flex-1" />
          <button class="text-red-500 hover:text-red-700 text-xs remover-opcao">Remover</button>
        `;
        opcoesContainer.appendChild(novaOpcao);

        novaOpcao.querySelector(".remover-opcao").addEventListener("click", () => {
          novaOpcao.remove();
        });
      });

      // Ativar remover op√ß√µes existentes
      enqueteDiv.querySelectorAll(".remover-opcao").forEach(botao => {
        botao.addEventListener("click", () => botao.parentElement.remove());
      });
    });

    // -------------------------
    // Gastos
    const btnAdicionarGasto = document.getElementById("adicionar-gasto");
    const listaGastos = document.getElementById("lista-gastos");
    const mensagemGastosVazia = document.getElementById("mensagem-gastos-vazia");
    const totalGastosDiv = document.getElementById("total-gastos");
    const valorTotalSpan = document.getElementById("valor-total");
    let total = 0;

    const formatarMoeda = valor =>
      valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });

    const atualizarTotal = () => {
      valorTotalSpan.textContent = total.toFixed(2).replace(".", ",");
      total > 0 ? totalGastosDiv.classList.remove("hidden") : totalGastosDiv.classList.add("hidden");
    };

    btnAdicionarGasto.addEventListener("click", () => {
      mensagemGastosVazia.classList.add("hidden");

      const gastoDiv = document.createElement("div");
      gastoDiv.className = "bg-white p-4 border rounded-xl shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-3";
      gastoDiv.innerHTML = `
        <div class="flex-1 flex flex-wrap gap-2 md:gap-3 items-center">
          <input type="text" placeholder="Descri√ß√£o do gasto" class="border rounded p-2 text-sm flex-1" />
          <input type="number" placeholder="Valor (R$)" min="0" step="0.01" class="border rounded p-2 text-sm w-28" />
          <select class="border rounded p-2 text-sm">
            <option value="">Categoria</option>
            <option>Transporte</option>
            <option>Alimenta√ß√£o</option>
            <option>Hospedagem</option>
            <option>Lazer</option>
            <option>Outros</option>
          </select>
        </div>
        <button class="bg-blue-500 text-white text-xs px-3 py-2 rounded hover:bg-blue-600 salvar-gasto">Salvar</button>
      `;
      listaGastos.appendChild(gastoDiv);

      gastoDiv.querySelector(".salvar-gasto").addEventListener("click", () => {
        const descricao = gastoDiv.querySelector("input[type='text']").value.trim();
        const valor = parseFloat(gastoDiv.querySelector("input[type='number']").value);
        const categoria = gastoDiv.querySelector("select").value;

        if (!descricao || isNaN(valor) || valor <= 0) {
          alert("Preencha uma descri√ß√£o e um valor v√°lido!");
          return;
        }

        total += valor;
        atualizarTotal();

        gastoDiv.innerHTML = `
          <div class="flex-1">
            <p class="font-medium">${descricao}</p>
            <p class="text-gray-500 text-sm">${categoria || "Sem categoria"}</p>
          </div>
          <div class="flex items-center gap-3">
            <span class="text-gray-700 font-semibold">${formatarMoeda(valor)}</span>
            <button class="text-red-500 hover:text-red-700 text-sm remover-gasto">Remover</button>
          </div>
        `;

        gastoDiv.querySelector(".remover-gasto").addEventListener("click", () => {
          total -= valor;
          gastoDiv.remove();
          atualizarTotal();
          if (listaGastos.children.length === 0) mensagemGastosVazia.classList.remove("hidden");
        });
      });
    });

    // -------------------------
    // Tarefas
    const btnAdicionarTarefa = document.getElementById("adicionar-tarefa");
    const listaTarefas = document.getElementById("lista-tarefas");
    const mensagemTarefasVazia = document.getElementById("mensagem-tarefas-vazia");

    btnAdicionarTarefa.addEventListener("click", () => {
      mensagemTarefasVazia.classList.add("hidden");

      const tarefaDiv = document.createElement("div");
      tarefaDiv.className = "bg-white p-4 border rounded-xl shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-3";
      tarefaDiv.innerHTML = `
        <div class="flex-1 flex flex-wrap gap-2 items-center">
          <input type="text" placeholder="Descri√ß√£o da tarefa" class="border rounded p-2 text-sm flex-1" />
          <select class="border rounded p-2 text-sm">
            <option value="">Prioridade</option>
            <option>Baixa</option>
            <option>M√©dia</option>
            <option>Alta</option>
          </select>
        </div>
        <button class="bg-blue-500 text-white text-xs px-3 py-2 rounded hover:bg-blue-600 salvar-tarefa">Salvar</button>
      `;
      listaTarefas.appendChild(tarefaDiv);

      tarefaDiv.querySelector(".salvar-tarefa").addEventListener("click", () => {
        const descricao = tarefaDiv.querySelector("input").value.trim();
        const prioridade = tarefaDiv.querySelector("select").value;

        if (!descricao) { alert("Digite uma descri√ß√£o para a tarefa!"); return; }

        const corPrioridade = { "Baixa": "bg-green-400", "M√©dia": "bg-yellow-400", "Alta": "bg-red-500" }[prioridade] || "bg-gray-400";

        tarefaDiv.innerHTML = `
          <div class="flex items-center gap-3 flex-1">
            <input type="checkbox" class="h-5 w-5 marcar-tarefa" />
            <div>
              <p class="descricao-tarefa font-medium">${descricao}</p>
              <p class="text-sm text-gray-500 flex items-center gap-1">
                <span class="w-3 h-3 inline-block rounded-full ${corPrioridade}"></span>
                ${prioridade || "Sem prioridade"}
              </p>
            </div>
          </div>
          <button class="text-red-500 hover:text-red-700 text-sm remover-tarefa">Remover</button>
        `;

        const checkbox = tarefaDiv.querySelector(".marcar-tarefa");
        const descricaoEl = tarefaDiv.querySelector(".descricao-tarefa");
        checkbox.addEventListener("change", () => {
          checkbox.checked ? descricaoEl.classList.add("line-through", "text-gray-400") : descricaoEl.classList.remove("line-through", "text-gray-400");
        });

        tarefaDiv.querySelector(".remover-tarefa").addEventListener("click", () => {
          tarefaDiv.remove();
          if (listaTarefas.children.length === 0) mensagemTarefasVazia.classList.remove("hidden");
        });
      });
    });

    // -------------------------
    // Membros
    const btnAdicionarMembro = document.getElementById("adicionar-membro");
    const listaMembros = document.getElementById("lista-membros");
    const mensagemMembrosVazia = document.getElementById("mensagem-membros-vazia");

    btnAdicionarMembro.addEventListener("click", () => {
      mensagemMembrosVazia.classList.add("hidden");

      const membroDiv = document.createElement("div");
      membroDiv.className = "bg-white p-4 border rounded-xl shadow-sm flex flex-col md:flex-row md:items-center justify-between gap-3";
      membroDiv.innerHTML = `
        <div class="flex-1 flex flex-wrap gap-2 items-center">
          <input type="text" placeholder="Nome do membro" class="border rounded p-2 text-sm flex-1" />
          <input type="text" placeholder="Fun√ß√£o (ex: organizador)" class="border rounded p-2 text-sm flex-1" />
        </div>
        <button class="bg-blue-500 text-white text-xs px-3 py-2 rounded hover:bg-blue-600 salvar-membro">Salvar</button>
      `;
      listaMembros.appendChild(membroDiv);

      membroDiv.querySelector(".salvar-membro").addEventListener("click", () => {
        const nome = membroDiv.querySelectorAll("input")[0].value.trim();
        const funcao = membroDiv.querySelectorAll("input")[1].value.trim();
        if (!nome) { alert("Digite o nome do membro!"); return; }

        membroDiv.innerHTML = `
          <div class="flex-1">
            <p class="font-medium">${nome}</p>
            <p class="text-gray-500 text-sm">${funcao || "Sem fun√ß√£o definida"}</p>
          </div>
          <button class="text-red-500 hover:text-red-700 text-sm remover-membro">Remover</button>
        `;
        membroDiv.querySelector(".remover-membro").addEventListener("click", () => {
          membroDiv.remove();
          if (listaMembros.children.length === 0) mensagemMembrosVazia.classList.remove("hidden");
        });
      });
    });

    // -------------------------
    // Sidebar interativa
    function toggleSidebar() {
      document.getElementById('sidebar').classList.toggle('-translate-x-full');
      document.getElementById('overlay').classList.toggle('hidden');
    }

    function showSection(section) {
      document.getElementById('dashboard').classList.add('hidden');
      document.getElementById('salas').classList.add('hidden');
      document.getElementById(section).classList.remove('hidden');

      document.getElementById('btn-dashboard').classList.remove('bg-blue-50','text-blue-600'); 
      document.getElementById('btn-dashboard').classList.add('text-gray-700');
      document.getElementById('btn-salas').classList.remove('bg-blue-50','text-blue-600'); 
      document.getElementById('btn-salas').classList.add('text-gray-700');
      if(section==='dashboard'){document.getElementById('btn-dashboard').classList.add('bg-blue-50','text-blue-600');}
      if(section==='salas'){document.getElementById('btn-salas').classList.add('bg-blue-50','text-blue-600');}
    }

    // Dados de usu√°rio
    const user = { name: "Viajante" };
    document.getElementById('sidebarUserName').textContent = user.name;
    document.getElementById('userInitial').textContent = user.name.charAt(0).toUpperCase();

    function logout(){ alert('Logout realizado'); }

    const adicionarBtn = document.getElementById('adicionar-dia');
const formRoteiro = document.getElementById('form-roteiro');
const salvarBtn = document.getElementById('salvar-dia');
const cancelarBtn = document.getElementById('cancelar-dia');

const roomContainer = document.getElementById('roteiro-container');
const roomId = roomContainer.dataset.roomId; // pega o ID da sala do atributo HTML

adicionarBtn.addEventListener('click', () => formRoteiro.classList.remove('hidden'));

cancelarBtn.addEventListener('click', () => {
  formRoteiro.classList.add('hidden');
  document.getElementById('dia-input').value = '';
  document.getElementById('hora-inicio-input').value = '';
  document.getElementById('hora-fim-input').value = '';
  document.getElementById('descricao-input').value = '';
});

salvarBtn.addEventListener('click', async () => {
  const dia = document.getElementById('dia-input').value;
  const horario_inicio = document.getElementById('hora-inicio-input').value;
  const horario_fim = document.getElementById('hora-fim-input').value;
  const descricao = document.getElementById('descricao-input').value;

  if (!dia || !descricao) {
    alert("Preencha pelo menos a data e a descri√ß√£o!");
    return;
  }

  const response = await fetch('/adicionar_roteiro', {
    method: 'POST',
    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
    body: new URLSearchParams({
      room_id: roomId,
      dia: dia,
      horario_inicio: horario_inicio,
      horario_fim: horario_fim,
      descricao: descricao
    })
  });

  if (response.ok) location.reload();
  else alert("Erro ao salvar roteiro");
});

document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('form-roteiro'); // seu formul√°rio existente
  const roteiroIdInput = document.getElementById('roteiro-id'); // campo hidden que voc√™ j√° tem ou cria
  const cancelarBtn = document.getElementById('cancelar-edicao') || null;
  const salvarBtn = document.getElementById('salvar-roteiro');

  document.addEventListener('DOMContentLoaded', () => {

  const form = document.getElementById('form-roteiro');
  const roteiroIdInput = document.getElementById('roteiro-id');
  const diaInput = document.getElementById('dia-input');
  const descricaoInput = document.getElementById('descricao-input');
  const horaInicioInput = document.getElementById('hora-inicio-input');
  const horaFimInput = document.getElementById('hora-fim-input');
  const salvarBtn = document.getElementById('salvar-dia');
  const cancelarBtn = document.getElementById('cancelar-dia');
  const diasContainer = document.getElementById('dias-container');
  const roomId = document.getElementById('roteiro-container').dataset.roomId;

  // === Editar roteiro ===
  diasContainer.querySelectorAll('.edit-dia').forEach(button => {
    button.addEventListener('click', () => {
      // Preenche o formul√°rio com os dados do roteiro selecionado
      roteiroIdInput.value = button.dataset.id;
      diaInput.value = button.dataset.dia;
      descricaoInput.value = button.dataset.descricao;
      horaInicioInput.value = button.dataset.inicio;
      horaFimInput.value = button.dataset.fim;

      // Altera o texto do bot√£o e mostra o formul√°rio
      salvarBtn.textContent = 'Atualizar Roteiro';
      cancelarBtn.classList.remove('hidden');
      form.classList.remove('hidden');
      form.scrollIntoView({ behavior: 'smooth' });
    });
  });

  // === Cancelar edi√ß√£o ===
  cancelarBtn.addEventListener('click', () => {
    roteiroIdInput.value = '';
    diaInput.value = '';
    descricaoInput.value = '';
    horaInicioInput.value = '';
    horaFimInput.value = '';
    salvarBtn.textContent = 'Adicionar Roteiro';
    cancelarBtn.classList.add('hidden');
    form.classList.add('hidden');
  });

  // === Salvar edi√ß√£o ===
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const roteiroId = roteiroIdInput.value;
    if (!roteiroId) return; // Se n√£o for edi√ß√£o, o fluxo de adicionar j√° cuida

    const payload = {
      dia: diaInput.value,
      descricao: descricaoInput.value,
      inicio: horaInicioInput.value,
      fim: horaFimInput.value
    };

    try {
      const res = await fetch(`/editar_roteiro/${roteiroId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const data = await res.json();
      if (data.success) {
        location.reload();
      } else {
        alert('Erro ao atualizar roteiro.');
      }
    } catch (err) {
      console.error(err);
      alert('Erro ao atualizar roteiro.');
    }
  });

});

  // === Excluir roteiro ===
  document.querySelectorAll('.delete-dia').forEach(button => {
    button.addEventListener('click', async () => {
      if (!confirm('Tem certeza que deseja excluir este roteiro?')) return;
      const id = button.dataset.id;

      try {
        const response = await fetch('/excluir_roteiro', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `id=${encodeURIComponent(id)}`
        });
        const data = await response.json();
        alert(data.message);
        location.reload();
      } catch (err) {
        console.error(err);
        alert('Erro ao excluir roteiro.');
      }
    });
  });
});
</script>

  </script>
</body>
</html>
